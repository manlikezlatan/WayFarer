{"version":3,"sources":["../../api/test/bookingTest.js"],"names":["chai","use","chaiHttp","should","trip_id","bus_id","trip_date","seat_number","faker","random","number","token","jwt","sign","email","user_id","is_admin","first_name","last_name","process","env","SECRET","expiresIn","beforeEach","pool","query","err","describe","it","done","request","app","post","end","res","have","status","body","be","a","property","eql","booking","set","send","get","data","undefined","put"],"mappings":"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","sourcesContent":["import chai from 'chai';\r\nimport chaiHttp from 'chai-http';\r\nimport jwt from 'jsonwebtoken';\r\nimport faker from 'faker';\r\nimport app from '../app';\r\nimport pool from '../models/dbPool';\r\n\r\nchai.use(chaiHttp);\r\nconst should = chai.should();\r\nshould;\r\n\r\nconst trip_id = 10;\r\nconst bus_id = 10;\r\nconst trip_date = '25-07-2019';\r\nconst seat_number = faker.random.number();\r\nconst token = jwt.sign(\r\n  {\r\n    email: 'zlatan@gmail.com',\r\n    user_id: 1,\r\n    is_admin: true,\r\n    first_name: 'Ibrahim',\r\n    last_name: 'Babatunde',\r\n  },\r\n  process.env.SECRET,\r\n  {\r\n    expiresIn: '2h',\r\n  },\r\n);\r\n\r\nbeforeEach(() => {\r\n  pool.query('TRUNCATE TABLE bookings CASCADE',\r\n    err => err);\r\n});\r\n\r\n\r\n// Test for booking a trip\r\ndescribe('/POST create new booking', () => {\r\n  it('it should not create a booking if authorization token is not provided', (done) => {\r\n    chai.request(app)\r\n      .post('/api/v1/bookings')\r\n      .end((err, res) => {\r\n        res.should.have.status(400);\r\n        res.body.should.be.a('object');\r\n        res.body.should.have.property('status').eql('error');\r\n        res.body.should.have.property('error').eql('Kindly provide token');\r\n        done(err);\r\n      });\r\n  });\r\n\r\n  it('it should not create a booking without a trip id', (done) => {\r\n    const booking = {\r\n      trip_id: '',\r\n      bus_id,\r\n      trip_date,\r\n      seat_number,\r\n    };\r\n    chai.request(app)\r\n      .post('/api/v1/bookings')\r\n      .set('token', token)\r\n      .send(booking)\r\n      .end((err, res) => {\r\n        res.should.have.status(400);\r\n        res.body.should.be.a('object');\r\n        res.body.should.have.property('status').eql('error');\r\n        res.body.should.have.property('error').eql('Kindly enter a correct trip ID');\r\n        done(err);\r\n      });\r\n  });\r\n\r\n  it('it should book a trip', (done) => {\r\n    const booking = {\r\n      trip_id,\r\n      bus_id,\r\n      trip_date,\r\n      seat_number,\r\n    };\r\n    chai.request(app)\r\n      .post('/api/v1/bookings')\r\n      .set('token', token)\r\n      .send(booking)\r\n      .end((err, res) => {\r\n        res.should.have.status(201);\r\n        res.body.should.be.a('object');\r\n        res.body.should.have.property('status').eql('success');\r\n        res.body.should.have.property('data');\r\n        done(err);\r\n      });\r\n  });\r\n});\r\n\r\n\r\n// Get all bookings\r\ndescribe('/GET/ view all bookings', () => {\r\n  it('it should return no bookings if there are no bookings', (done) => {\r\n    chai.request(app)\r\n      .get('/api/v1/bookings')\r\n      .set('token', token)\r\n      .end((err, res) => {\r\n        if (res.body.data === undefined) {\r\n          res.should.have.status(404);\r\n          res.body.should.be.a('object');\r\n          res.body.should.have.property('status').eql('error');\r\n          res.body.should.have.property('error').eql('There are currently no bookings');\r\n        }\r\n        done(err);\r\n      });\r\n  });\r\n  it('it should get all bookings for an admin', (done) => {\r\n    chai.request(app)\r\n      .get('/api/v1/bookings')\r\n      .set('token', token)\r\n      .end((err, res) => {\r\n        if (!res.body.data === undefined) {\r\n          res.should.have.status(200);\r\n          res.body.should.be.a('object');\r\n          res.body.should.have.property('status').eql('success');\r\n          res.body.should.have.property('data');\r\n        }\r\n        done(err);\r\n      });\r\n  });\r\n});\r\n\r\n// delete a booking\r\ndescribe('/DELETE/ delete a booking', () => {\r\n  it('it should return no bookings with that id if specified booking id is incorrect', (done) => {\r\n    chai.request(app)\r\n      .delete('/api/v1/bookings/1')\r\n      .set('token', token)\r\n      .end((err, res) => {\r\n        if (res.body.data === undefined) {\r\n          res.should.have.status(404);\r\n          res.body.should.be.a('object');\r\n          res.body.should.have.property('status').eql('error');\r\n          res.body.should.have.property('error').eql('You have no booking with the specified booking ID');\r\n        }\r\n        done(err);\r\n      });\r\n  });\r\n\r\n  it('it should return booking deleted successfully if specified booking id is correct', (done) => {\r\n    chai.request(app)\r\n      .delete('/api/v1/bookings/1')\r\n      .set('token', token)\r\n      .end((err, res) => {\r\n        if (!res.body.data === undefined) {\r\n          res.should.have.status(200);\r\n          res.body.should.be.a('object');\r\n          res.body.should.have.property('status').eql('success');\r\n          res.body.data.should.have.property('message').eql('Booking deleted successfully');\r\n\r\n        }\r\n        done(err);\r\n      });\r\n  });\r\n});\r\n\r\n// Update seat number of a booking\r\ndescribe('/PUT update seat number of a booking', () => {\r\n  it('it should not UPDATE booking seat number if auth token is not provided', (done) => {\r\n    chai.request(app)\r\n      .put('/api/v1/bookings/1')\r\n      .end((err, res) => {\r\n        res.should.have.status(400);\r\n        res.body.should.be.a('object');\r\n        res.body.should.have.property('status').eql('error');\r\n        res.body.should.have.property('error').eql('Kindly provide token');\r\n        done(err);\r\n      });\r\n  });\r\n\r\n  it('it should not update booking seat number if seat number is not provided', (done) => {\r\n    const booking = {\r\n      seat_number: '',\r\n    };\r\n    chai.request(app)\r\n      .put('/api/v1/bookings/1')\r\n      .set('token', token)\r\n      .send(booking)\r\n      .end((err, res) => {\r\n        res.should.have.status(400);\r\n        res.body.should.be.a('object');\r\n        res.body.should.have.property('status').eql('error');\r\n        res.body.should.have.property('error').eql('Choose a seat number');\r\n        done(err);\r\n      });\r\n  });\r\n});\r\n"],"file":"bookingTest.js"}